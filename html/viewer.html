<!DOCTYPE html>
<html lang="en" data-theme="light" >
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Presentation Overview of Numerical Integrators for ODE</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  
  <!-- Pico.css -->
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css" />
      
  <!-- KaTeX -->
  <script src="https://unpkg.com/asciimath2tex@1.2.1/dist/asciimath2tex.umd.js" type="text/javascript" ></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous" type="text/javascript" ></script> 
  
  <!-- highlight -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/default.min.css">
  
  <!-- math.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.4/math.js" type="text/javascript" ></script>

  <!-- d3.js -->
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-contour@3"></script>

  <!-- double slider -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.6.0/nouislider.css" integrity="sha512-MKxcSu/LDtbIYHBNAWUQwfB3iVoG9xeMCm32QV5hZ/9lFaQZJVaXfz9aFa0IZExWzCpm7OWvp9zq9gVip/nLMg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- custom css -->
  <link rel="stylesheet" href="style.css" />
</head>
<body style="--font-size: 16px;" >
  
  <main id="list"></main>

  <footer>
    <nav>
      <ul>
        <li id="btn_add" ></li>
        <li><button id="switcher" class="switcher" aria-label="Turn off dark mode"><span>üêà‚Äç‚¨õ</span></button></li>
        <li><button id="show_footer" ><span>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
        </span></button></li>
      </ul>
      <ul>
        <li>Une petite liste de m√©thodes de type Runge-Kutta</li>
      </ul>
    </nav>
    <fieldset class="form_sort" >
        <label for="sort" >Sorting by:</label>
        <select name="sort" id="sort" >
          <option value="alpha" >Alphabetical</option>
          <option value="order" >Order</option>
          <option value="stages" >Number of stages</option>
          <option value="stage_order" >Stage order</option>
          <option value="xmax" disabled >Real stability interval</option>
          <option value="ymax" disabled >Imaginary stability interval</option>
        </select>
        <button id="sort_btn" >Sort!</button>
    </fieldset>
    <fieldset class="form_filter" >
      <label>Order:</label>
      <div id="order_slider" class="noUi-active" ></div>
      
      <fieldset class="grid" >
        <legend>Type</legend>
        <label for="explicit">
          <input type="radio" id="explicit" value="explicit" name="filter_type">
          Explicit method
        </label>
        <label for="implicit">
          <input type="radio" id="implicit" value="implicit" name="filter_type">
          Implicit method
        </label>
        <label for="dirk">
          <input type="radio" id="dirk" value="dirk" name="filter_type">
          DIRK method
        </label>
        <label for="embedded">
          <input type="radio" id="embedded" value="embedded" name="filter_type">
          Embedded method
        </label>
        <label for="reset">
          <input type="radio" id="reset" value="reset" name="filter_type" checked >
          Reset filter
        </label>
      </fieldset>
      
      <button id="filter_btn" >Filter!</button>
    </fieldset>
  </footer>

  <script>
const my_color   = "#00acc1"; //getComputedStyle(document.getElementsByTagName('html')[0]).getPropertyValue('--my-color');
const axis_color = "hsl(205deg, 20%, 32%)"; //getComputedStyle(document.getElementsByTagName('html')[0]).getPropertyValue('--color');

let ul = document.getElementById("list");

const parser = new AsciiMathParser(); // to convert python expression (asciimath ich) into LaTeX expression
function asciimath(expr) {
  return expr.replaceAll("**","^").replaceAll(/\d\*\d/ig,"x");
}
function render(expr,elm) {
  katex.render(parser.parse(asciimath(expr)),elm,{displayMode:true});
  return elm;
}

function label(id,lab) {
  let header = document.createElement("header");
  //let h2 = document.createElement("h2");
  //h2.appendChild(document.createTextNode(lab));
  //header.appendChild(h2);
  let a = document.createElement("a");
  a.href = "#" + id;
  a.appendChild(document.createTextNode(lab));
  header.appendChild(a);
  
  return header;
}

function butcher_tableau(A,b,c,b2=undefined) {
  let is_embedded = ( b2 !== undefined );

  let container = document.createElement("div");
  container.classList.add("butcher_container");
  let tab = document.createElement("table");
  tab.classList.add("butcher");
  if (is_embedded) { tab.classList.add("embedded"); }
  for (i=0;i<A.length;++i) {
    let tr = document.createElement("tr");
    let ci = document.createElement("td");
    render(c[i],ci);
    tr.appendChild(ci);
    for (j=0;j<A[i].length;++j) {
      let aij = document.createElement("td");
      render(A[i][j],aij);
      tr.appendChild(aij);
    }
    tab.appendChild(tr);
  }

  let tr = document.createElement("tr");
  tr.appendChild(document.createElement("td"));
  for (i=0;i<b.length;++i) {
    let bi = document.createElement("td");
    render(b[i],bi);
    tr.appendChild(bi);
  }
  tab.appendChild(tr);

  if ( is_embedded ) {
    let tr = document.createElement("tr");
    tr.appendChild(document.createElement("td"));
    for (i=0;i<b2.length;++i) {
      let b2i = document.createElement("td");
      render(b2[i],b2i);
      tr.appendChild(b2i);
    }
    tab.appendChild(tr);
  }

  container.appendChild(tab);

  return container;
}

function stability_function(R_expr) {
  let div = document.createElement("div");
  div.classList.add("stability_function");
  render(R_expr,div);
  
  return div;
}
function resume_tableau(nstages,order,stage_order) {
  let tab = document.createElement("table");
  tab.classList.add("resume_tableau");
  
  let tr1 = document.createElement("tr");
  let th1 = document.createElement("th"); th1.setAttribute('scope',"row"); th1.appendChild(document.createTextNode("#stages"));
  let td1 = document.createElement("td"); td1.appendChild(document.createTextNode(nstages));
  tr1.appendChild(th1); tr1.appendChild(td1);
  tab.appendChild(tr1);

  let tr2 = document.createElement("tr");
  let th2 = document.createElement("th"); th2.setAttribute('scope',"row"); th2.appendChild(document.createTextNode("order"));
  let td2 = document.createElement("td"); td2.appendChild(document.createTextNode(order));
  tr2.appendChild(th2); tr2.appendChild(td2);
  tab.appendChild(tr2);

  let tr3 = document.createElement("tr");
  let th3 = document.createElement("th"); th3.setAttribute('scope',"row"); th3.appendChild(document.createTextNode("stage order"));
  let td3 = document.createElement("td"); td3.appendChild(document.createTextNode(stage_order));
  tr3.appendChild(th3); tr3.appendChild(td3);
  tab.appendChild(tr3);

  return tab;
}

function expr_to_canvas(f,[xmin,xmax],[ymin,ymax],thresholds) {
  let canvas = document.createElement("canvas");
  canvas.height = 300;
  canvas.width  = 300;
  const n = 512, m = 512;

  context = canvas.getContext("2d");
  projection = d3.geoIdentity().scale(canvas.width / n);
  path = d3.geoPath(projection,context);

  let values = new Array(n * m);
  for (let j = 0, k = 0; j < m; ++j) {
    for (let i = 0; i < n; ++i, ++k) {
      values[k] = f( i * (xmax-xmin)/ n + xmin, j * (ymax-ymin)/ m + ymin);
    }
  }

  const contours = d3.contours()
    .size([n,m])
    .thresholds(thresholds)
    (values);
  contours.forEach( c => {
    if (c.coordinates.length == 0) return;
    context.beginPath();
    path(c);
    context.fillStyle = "#fefefe";
    context.fill();
    //context.stroke();
  });

  return canvas;
}
function data_to_canvas(data,[xmin,xmax],[ymin,ymax],thresholds,outside=true,data2=undefined) {
  let canvas = document.createElement("canvas");
  canvas.height = 512;
  canvas.width  = 512;
  const n = data[0].length , m = data.length;

  context = canvas.getContext("2d");
  projection = d3.geoIdentity().scale(canvas.width / n);
  path = d3.geoPath(projection,context);

  const contours = d3.contours()
    .size([n,m])
    .thresholds(thresholds)
    ( [].concat(...data) );
  contours.forEach( c => {
    if (c.coordinates.length == 0) return;
    context.beginPath();
    path(c);
    if ( outside ) {
      context.rect(0,0,canvas.width,canvas.height);
    }
    context.fillStyle = my_color;
    context.fill();
  });
  if ( data2 !== undefined ) {
    const contours2 = d3.contours()
      .size([n,m])
      .thresholds(thresholds)
      ( [].concat(...data2) );
    contours2.forEach( c => {
      if (c.coordinates.length == 0) return;
      context.beginPath();
      path(c);
      context.lineWidth = 3.0;
      context.strokeStyle = "#000000";
      context.stroke();
    });
  }

  // draw axis
  const dx = (xmax-xmin)/canvas.width;
  const dy = (ymax-ymin)/canvas.height;
  const i_0 = parseInt((-xmin)/dx), j_0 = parseInt(-ymin/dy);

  context.strokeStyle = axis_color;
  context.lineWidth = 1.0;
  // real axis
  context.beginPath();
  context.moveTo(0,j_0);
  context.lineTo(n,j_0);
  context.closePath();
  context.stroke();
  // imaginary axis
  context.beginPath();
  context.moveTo(i_0,0);
  context.lineTo(i_0,n);
  context.closePath();
  context.stroke();

  // xticks
  for ( x=parseInt(xmin)-1 ; x<xmax ; ++x ) {
    context.beginPath();
    context.moveTo(parseInt((x-xmin)/dx),j_0-5);
    context.lineTo(parseInt((x-xmin)/dx),j_0+5);
    context.closePath();
    context.stroke();
  }
  // yticks
  for ( y=parseInt(ymin)-1 ; y<ymax ; ++y ) {
    context.beginPath();
    context.moveTo(i_0-5,parseInt((y-ymin)/dy));
    context.lineTo(i_0+5,parseInt((y-ymin)/dy));
    context.closePath();
    context.stroke();
  }

  
  return canvas;
}

function stability_domain( data ) {
  let fig = document.createElement("figure");
  fig.appendChild( data_to_canvas(data.data,[data.xmin,data.xmax],[data.ymin,data.ymax],[1.0],outside=true,data2=data.data_embedded) );
  let caption = document.createElement("figcaption");
  let def = document.createElement("span"); katex.render(String.raw`\mathcal{D} = \{ z\in\mathbb{C}\,/\,|R(z)| \leq 1 \}`,def,{displayMode:true});
  caption.innerHTML = "Stability domain: " + def.outerHTML;
  fig.appendChild(caption);
  return fig;
}
function order_star( data ) {
  let fig = document.createElement("figure");
  fig.appendChild(data_to_canvas(data.data,[data.xmin,data.xmax],[data.ymin,data.ymax],[1.0]));
  let caption = document.createElement("figcaption");
  let def = document.createElement("span"); katex.render(String.raw`\mathcal{A}_- = \{ z\in\mathbb{C}\,/\,|e^{-z}R(z)| < 1 \}`,def,{displayMode:true});
  caption.innerHTML = "Order star: " + def.outerHTML;
  fig.appendChild(caption);
  return fig;
}

function prepare_canvas(id) {
  let div = document.createElement("div");
  div.classList.add("drawing");
  div.setAttribute("data-id",id);

  return div;
}

function scheme(stages) {
  let ul = document.createElement("ul");
  ul.classList.add("scheme");
  stages.map(eq => {
    let li = document.createElement("li");
    katex.render(eq,li,{displayMode:true});
    ul.appendChild(li);
  });
  return ul;
}
function code(c,id) {
  let pre = document.createElement("pre");
  let code = document.createElement("code");
  code.classList.add("language-py");
  code.innerHTML = hljs.highlight(c,{language: 'python'}).value;
  code.id = "code-"+id;
  
  pre.appendChild(code);

  let btn = document.createElement('button');
  btn.classList.add("clipboard");
  btn.setAttribute("data-clipboard-target","#"+code.id);
  btn.innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-paperclip'><path d='M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48'></path></svg><span>Copy code</span>";
  pre.appendChild(btn);

  return pre;
}
function lscheme(stages) {
  let ul = document.createElement("ul");
  ul.classList.add("lawson-scheme");
  stages.map(eq => {
    let li = document.createElement("li");
    katex.render(eq,li,{displayMode:true});
    ul.appendChild(li);
  });
  return ul;
}

function rk_to_elm(rk,elm) {
  elm.id = rk.id;
  elm.classList.add('method');
  elm.setAttribute("data-order",rk.order);
  elm.setAttribute("data-nstages",rk.nstages);
  elm.setAttribute("data-stage_order",rk.stage_order);
  elm.setAttribute("data-xmax",0.);
  elm.setAttribute("data-ymax",0.);
  elm.setAttribute("data-explicit",rk.is_explicit);
  elm.setAttribute("data-dirk",rk.is_dirk);
  elm.setAttribute("data-embedded",rk.is_embedded);
  
  elm.appendChild(label(rk.id,rk.label));
  elm.appendChild(butcher_tableau(rk.A,rk.b,rk.c,rk.b2));
  
  if (rk.hasOwnProperty('stability_function')) {
    let details = document.createElement("details");
    
    let summary = document.createElement("summary");
    summary.appendChild(document.createTextNode("Details"))
    details.appendChild(summary);
    
    let p = document.createElement("p");
    let title_R = document.createElement("h6");
    let R = document.createElement("span"); katex.render("R(z)",R);
    title_R.innerHTML = "Stability function "+R.outerHTML+":";
    p.appendChild(title_R);
    p.appendChild(stability_function(rk.stability_function));
    p.appendChild(resume_tableau(rk.nstages,rk.order,rk.stage_order));
    p.appendChild(prepare_canvas(rk.id));
    
    summary.addEventListener('click',function (event){
        let div = event.target.parentElement.children[1].getElementsByClassName("drawing")[0];
        let id = div.getAttribute("data-id");
        const rk_url = new URL(window.location.href.split("/").slice(0,-1).join("/") + "/api/" + rk.id + ".json");
        fetch(rk_url)
          .then( res => res.json() )
          .then( out => {
            div.appendChild(stability_domain(out.stability_domain));
            div.appendChild(order_star(out.order_star));
          });
      },{'once':true});

    

    let title_edo = document.createElement("h6"); title_edo.appendChild(document.createTextNode("Runge-Kutta scheme:")); p.appendChild(title_edo);
    let edo = document.createElement("p"); katex.render("\\dot{u}=f(t,u)",edo,{displayMode:true});
    p.appendChild(edo);
    p.appendChild(scheme(rk.scheme));
  
    if (rk.hasOwnProperty('code')) {
      p.appendChild(code(rk.code,rk.id));
    }
    
    let title_ledo = document.createElement("h6"); title_ledo.appendChild(document.createTextNode("Lawson scheme:")); p.appendChild(title_ledo);
    let ledo = document.createElement("p"); katex.render("\\dot{u}=Lu + N(t,u)",ledo,{displayMode:true});
    p.appendChild(ledo);
    p.appendChild(scheme(rk.lawson_scheme));
  
    if (rk.hasOwnProperty('lawson_code')) {
      p.appendChild(code(rk.lawson_code,"l_"+rk.id));
      let warning = document.createElement("blockquote");
      warning.classList.add("warning");
      warning.innerHTML = "default NumPy function <a href='https://numpy.org/doc/stable/reference/generated/numpy.exp.html'><samp>np.exp</samp></a> for exponantial take the exponential of each terms of <samp>ndarray</samp>, which is not the exponential of a matrix needed by Lawson method. If this is for matrix computation, prefer <a href='https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.expm.html'><samp>scipy.linalg.expm</samp></a> function.";
      p.appendChild(warning);
    }

    details.appendChild(p);
    elm.appendChild(details);
  }

  return elm;
}

const url = new URL(window.location.href.split("/").slice(0,-1).join("/") + "/api/analysis.json");

fetch(url)
    .then( res => res.json() )
    .then((out) => {
      out.forEach((rk) => {
        //console.log(rk.label);
        ul.appendChild(rk_to_elm(rk,document.createElement("article")));
      })
      
      if ( location.hash !== "" ) {
        location.href = location.href;
      }
    });
  </script>

<script src="themeSwitcher.js" type="text/javascript" ></script>

<!-- double slider -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.6.0/nouislider.min.js" integrity="sha512-1mDhG//LAjM3pLXCJyaA+4c+h5qmMoTc7IuJyuNNPaakrWT9rVTxICK4tIizf7YwJsXgDC2JP74PGCc7qxLAHw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="filter.js" type="text/javascript" ></script>

<!-- highlight -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js" type="text/javascript" ></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/python.min.js" type="text/javascript" ></script>

<!-- clipboard -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>
<script src="clipboardSet.js" type="text/javascript" ></script>

<script src="addMethod.js" type="text/javascript" ></script>

<script src="copyKaTeX.js" type="text/javascript" ></script>

</body>
</html>