import analysis as an
import sympy as sp
import json

Q = sp.Rational

# RK5(4)7M
A = [
        [ 0             , 0             , 0             , 0          , 0             , 0        , 0 ],
        [ Q(1,5)        , 0             , 0             , 0          , 0             , 0        , 0 ],
        [ Q(3,40)       , Q(9,40)       , 0             , 0          , 0             , 0        , 0 ],
        [ Q(44,45)      ,-Q(56,15)      , Q(32,9)       , 0          , 0             , 0        , 0 ],
        [ Q(19372,6561) ,-Q(25360,2187) , Q(64448,6561) ,-Q(212,729) , 0             , 0        , 0 ],
        [ Q(9017,3168)  ,-Q(355,33)     , Q(46732,5247) , Q(49,176)  ,-Q(5103,18656) , 0        , 0 ],
        [ Q(35,384)     , 0             , Q(500,1113)   , Q(125,192) ,-Q(2187,6784)  , Q(11,84) , 0 ]
    ]
b  = [ Q(35,384)     , 0 , Q(500,1113)   , Q(125,192) ,-Q(2187,6784)    , Q(11,84)    , 0       ]
b2 = [ Q(5179,57600) , 0 , Q(7571,16695) , Q(393,640) ,-Q(92097,339200) , Q(187,2100) , Q(1,40) ]
c  = [ 0 , Q(1,5) , Q(3,10) , Q(4,5) , Q(8,9) , 1 , 1 ]

rk547m = an.rk_butcher(label="RK5(4) 7M",A=A,b=b,b2=b2,c=c)

# RK5(4)7M
A = [
        [ 0             , 0             , 0             , 0          , 0             , 0        , 0 ],
        [ Q(2,9)        , 0             , 0             , 0          , 0             , 0        , 0 ],
        [ Q(1,12)       , Q(1,4)        , 0             , 0          , 0             , 0        , 0 ],
        [ Q(55,324)     ,-Q(25,108)     , Q(50,81)      , 0          , 0             , 0        , 0 ],
        [ Q(83,330)     ,-Q(13,22)      , Q(61,66)      , Q(9,110)   , 0             , 0        , 0 ],
        [-Q(19,28)      , Q(9,4)        , Q(1,7)        ,-Q(27,7)    , Q(22,7)       , 0        , 0 ],
        [ Q(19,200)     , 0             , Q(3,5)        ,-Q(243,400) , Q(33,40)      , Q(7,80)  , 0 ]
    ]
b  = [ Q(19,200)     , 0             , Q(3,5)        ,-Q(243,400)    , Q(33,40)      , Q(7,80)     , 0       ]
b2 = [ Q(431,5000)   , 0             , Q(333,500)    ,-Q(7857,10000) , Q(957,1000)   , Q(193,2000) ,-Q(1,50) ]
c  = [ 0 , Q(2,9) , Q(1,3) , Q(5,9) , Q(2,3) , 1 , 1 ]

rk547s = an.rk_butcher(label="RK5(4) 7S",A=A,b=b,b2=b2,c=c)

# RK5(4)6M
A = [
        [ 0           , 0             , 0             , 0          , 0             , 0 ],
        [ Q(1,5)      , 0             , 0             , 0          , 0             , 0 ],
        [ Q(3,40)     , Q(9,40)       , 0             , 0          , 0             , 0 ],
        [ Q(3,10)     ,-Q(9,10)       , Q(6,5)        , 0          , 0             , 0 ],
        [ Q(226,729)  ,-Q(25,27)      , Q(880,729)    , Q(55,729)  , 0             , 0 ],
        [-Q(181,270)  , Q(5,2)        ,-Q(266,297)    ,-Q(91,27)   , Q(189,55)     , 0 ],
    ]
b  = [ Q(19,216)     , 0             , Q(1000,2079)  ,-Q(125,216) , Q(81,88)     , Q(5,56) ]
b2 = [ Q(31,540)     , 0             ,-Q(190,297)    ,-Q(145,108) , Q(351,220)   , Q(1,20) ]
c  = [ 0 , Q(2,9) , Q(1,3) , Q(5,9) , Q(2,3) , 1 , 1 ]

rk546m = an.rk_butcher(label="RK5(4) 6M",A=A,b=b,b2=b2,c=c)


print( json.dumps(list(map(dict,[rk547s,rk546m])),indent=4) )

exit()

print(dict(rk547m))
print(rk547m.stability_function(embedded=True))
print(rk547m.stability_function(embedded=False))
print(rk547m.order)
print(rk547m.nstages)
print(rk547m.is_embedded)
print(rk547m.is_dirk)
print(rk547m.stage_order)
for eq in rk547m.scheme(latex=False):
    print("{} = {}".format(eq.lhs,eq.rhs))

print(rk547m.code())
print(rk547m.code(lawson=True))

